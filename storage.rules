rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // users
    match /users/{uid} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // riders
    match /riders/{uid} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // addresses (ให้เจ้าของแก้ของตนเองเท่านั้น)
    match /addresses/{id} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &&
                   request.resource.data.owner_user_id == request.auth.uid;
    }

    // packages + subcollection images
    match /packages/{packageId} {
      allow read: if request.auth != null;

      // เขียนจำกัด (ส่วนมากทำผ่าน Cloud Functions/เซิร์ฟเวอร์)
      allow write: if false;

      match /images/{imgId} {
        allow read: if request.auth != null;
        allow write: if false;
      }
    }
  }
}

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // รูปรถ/ยานพาหนะของไรเดอร์
    match /rider_vehicles/{uid}.jpg {
      allow read: if request.auth != null;  // หรือ public -> if true;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // รูปหลักฐานของพัสดุ
    match /package_images/{packageId}/{imgId}.jpg {
      allow read: if request.auth != null;
      // เขียนโดยระบบ/ฟังก์ชัน หรือไรเดอร์ที่รับงาน (ต้องเช็คเพิ่มใน Functions หากต้องการ)
      allow write: if request.auth != null; // ปรับให้เข้มตามนโยบายได้
    }
  }
}

